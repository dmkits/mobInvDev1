<!--suppress ALL, JSAnnotator -->
<template>
<div class="page page-with-subnavbar" id="viewListInvents">
    <div class="navbar">
        <div class="navbar-inner">
            <div class="left">
                <a href="#" class="link icon-only panel-open" data-panel="left">
                    <i class="icon f7-icons">menu</i>
                </a>
            </div>
            <div class="title sliding">Инвентаризации</div>
            <div class="subnavbar">
                <div class="subnavbar-inner">
                    <div class="list" style="width:100%">
                        <ul>
                            <li>
                                <a href="#" class="item-link smart-select" @smartselect:closed="viewListInventsStockClosed">
                                    <select id="viewListInvents-stock">
                                        {{#each listStocks}}
                                        <option value={{stockID}}>{{stockName}}</option>
                                        {{/each}}
                                    </select>
                                    <div class="item-content">
                                        <div class="item-inner">
                                            <div class="item-title">Склад</div>
                                            <div class="item-after"></div>
                                        </div>
                                    </div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page-content">
        <div class="list media-list" style="margin:0">
            <ul>
                {{#each listInvents}}
                <li>
                    <a class="item-link item-content" href="/viewInvent/{{chID}}">
                        <div class="item-inner" style="padding-top:4px;padding-bottom:0px;">
                            <div class="item-title-row">
                                <div class="item-title" style="width:100%">
                                    <div class="item-title">
                                        <div class="item-header" style="display:inline-block;float:left">{{docID}} от {{docDate}}</div>
                                        <div class="item-header" style="display:inline-block;float:right">{{stateName}}</div>
                                    </div>
                                    <div class="item-title">{{stockName}}</div>
                                </div>
                                <div class="item-after" style="min-width:80px">
                                    <div style="width:100%;text-align:right">{{summ}}</div>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                {{/each}}
            </ul>
        </div>
    </div>
</div>
</template>
<script>
    return {
        methods:{
            loadListInventsData:function(){
                let cInstance=this, app=this.$app,
                    stockID=$$('#viewListInvents-stock').val();
                app.preloader.show();
                app7.request.json(app.data['serverURI']+'/mobile/ven/getDataForVensList',
                    function(data){                                                                         console.log('/mobile/ven/getDataForVensList',data);
                        // update component state with new state

                        app.preloader.hide();// Hide Preloader
                        app.data.viewListInvents={listStocks:[],listInvents:[]};                            console.log('viewListInvents.html pageAfterIn app.data.viewListInvents 2=',app.data.viewListInvents);
                        cInstance.$setState({
                            listStocks:listStocks,
                            listInvents:listInventsByStockID
                        });

                        // let logInSuccess=false, msg='';
                        // if(data&&data.error){
                        //     if(data.userErrorMsg)msg=data.userErrorMsg;
                        //     else msg="Вход на сервер неудался!<br>"+data.error;
                        // } else if(data&&data.result=='success'){
                        //     logInSuccess=true;
                        //
                        // } else
                        //     msg="Вход на сервер неудался!";
                        // if(logInSuccess){
                        //     mainView.router.navigate('/viewListInvents/');
                        //     if (typeof(Storage)!=="undefined") {
                        //         localStorage.setItem("login-username",username);
                        //     } else {// Sorry! No Web Storage support..
                        //     }
                        //     return
                        // }
                        // app7.dialog.alert(msg,"Внимание", function(){
                        //     $$('#mobInv-login-screen #login-username').val("");
                        //     $$('#mobInv-login-screen #login-password').val("");
                        // });
                    },function(err,e){                                                                      console.log('/mobile/ven/getDataForVensList error',err,e);
                        // var state=err.status, msg='';
                        // if(state===0){
                        //     msg="Неправильный или недействительный адрес сервера"+
                        //         "<br>или доступ по указанному адресу сервера запрещен.";
                        // } else
                        //     msg="Не удалось свзаться с сервером по указанному адресу.";
                        // app7.dialog.alert(msg,"Внимание");

                    });
                return;
                setTimeout(function () {
                        let listStocks=[
                            {stockID:11,stockName:'Калинівка Каштан 0'},
                            {stockID:222,stockName:'Калинівка Каштан 1'},
                            {stockID:3333,stockName:'Калинівка Каштан 3'},
                            {stockID:144,stockName:'Склад сумки та одяг (Калинівка)'},
                            {stockID:255,stockName:'Могилів-Подільський 1 ТЦ"Гусі-Лебеді'},
                            {stockID:366,stockName:'Могилів-Подільський 2'}
                        ]
                        let listInvents=[
                            {chID:1001,docID:123,docDate:'2018-11-01',stockName:'Калинівка Каштан 0',summ:123.45,stateName:'В работе'},
                            {chID:1002,docID:124,docDate:'2018-11-02',stockName:'Калинівка Каштан 0',summ:1234.56,stateName:'В работе'},
                            {chID:1003,docID:1245,docDate:'2018-11-03',stockName:'Склад сумки та одяг (Калинівка)',summ:12345.67,stateName:'В работе'},
                            {chID:1004,docID:1246,docDate:'2018-11-03',stockName:'Могилів-Подільський 1 ТЦ"Гусі-Лебеді',summ:12345.67,stateName:'В работе'},
                            {chID:1005,docID:1250,docDate:'2018-11-04',stockName:'Склад сумки та одяг (Калинівка)',summ:987654.32,stateName:'Документ закрыт'},
                            {chID:1006,docID:1255,docDate:'2018-11-04',stockName:'Калинівка Каштан 0',summ:6543.21,stateName:'В работе'},
                            {chID:1007,docID:1256,docDate:'2018-11-05',stockName:'Склад сумки та одяг (Калинівка)',summ:0.00,stateName:'В работе'},
                            {chID:1008,docID:1259,docDate:'2018-11-05',stockName:'Могилів-Подільський 1 ТЦ"Гусі-Лебеді',summ:900987.99,stateName:'Документ закрыт'},
                            {chID:1009,docID:1267,docDate:'2018-11-06',stockName:'Калинівка Каштан 0',summ:159753.46,stateName:'Документ закрыт'},
                            {chID:1010,docID:1269,docDate:'2018-11-07',stockName:'Склад сумки та одяг (Калинівка)',summ:0.00,stateName:'В работе'},
                            {chID:1011,docID:1271,docDate:'2018-11-08',stockName:'Могилів-Подільський 1 ТЦ"Гусі-Лебеді',summ:987.65,stateName:'Документ закрыт'}
                        ];
                        let listInventsByStockID=listInvents;
                        if(stockID&&stockID.toString().trim()!=''){
                            let stockName='';
                            for(var ind in listStocks){
                                var listStocksItem=listStocks[ind];
                                if(listStocksItem["stockID"]==stockID){
                                    stockName=listStocksItem["stockName"];
                                    break;
                                }
                            }
                            listInventsByStockID=[];
                            for(var ind in listInvents){
                                var listInventsItem=listInvents[ind];
                                if(listInventsItem["stockName"]==stockName)listInventsByStockID.push(listInventsItem);
                            }
                        }
                        app.preloader.hide();// Hide Preloader
                        app.data.viewListInvents={listStocks:listStocks,listInvents:listInventsByStockID};   console.log('viewListInvents.html pageAfterIn app.data.viewListInvents 2=',app.data.viewListInvents);
                        cInstance.$setState({
                            listStocks:listStocks,
                            listInvents:listInventsByStockID
                        });
                }, 1000);
                // app.request.get('http://api.website.com/get-user-profile', (user) => {
                //     // update component state with new state
                // });            },
            },
            viewListInventsStockClosed:function(e){
                this.loadListInventsData();
            }
        },
        on: {
            pageAfterIn: function(e, page) {                                                             console.log('viewListInvents.html pageAfterIn', page, this);
                let app=page.app, cInstance=this;
                if(app.data.viewListInvents) return
                cInstance.loadListInventsData();
            }
        }
    }
</script>
